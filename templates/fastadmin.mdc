# Lyfe's FastAdminå¼€å‘è§„åˆ™

## è§„åˆ™å…ƒä¿¡æ¯
**è§„åˆ™åç§°**: fastadmin-rules  
**è§„åˆ™æè¿°**: FastAdminæ¡†æ¶å¼€å‘çš„å®Œæ•´æŒ‡å¯¼è§„åˆ™ï¼ŒåŒ…å«æ¡†æ¶ç‰¹æ€§ã€å¼€å‘è§„èŒƒã€å‘½ä»¤ä½¿ç”¨å’Œæœ€ä½³å®è·µ  
**é€‚ç”¨èŒƒå›´**: åŸºäºFastAdminæ¡†æ¶çš„åå°ç®¡ç†ç³»ç»Ÿå¼€å‘  

## 1. æ¡†æ¶æ¦‚è¿°

### 1.1 FastAdminç®€ä»‹
FastAdminæ˜¯ä¸€æ¬¾åŸºäºThinkPHP5+Bootstrapçš„æé€Ÿåå°å¼€å‘æ¡†æ¶ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š
- åŸºäºAuthéªŒè¯çš„æƒé™ç®¡ç†ç³»ç»Ÿ
- å¼ºå¤§çš„ä¸€é”®ç”ŸæˆCRUDåŠŸèƒ½
- å®Œå–„çš„å‰ç«¯åŠŸèƒ½ç»„ä»¶
- å¼ºå¤§çš„æ’ä»¶æ‰©å±•åŠŸèƒ½
- é€šç”¨çš„ä¼šå‘˜æ¨¡å—å’ŒAPIæ¨¡å—

### 1.2 æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: ThinkPHP5
- **å‰ç«¯æ¡†æ¶**: Bootstrap + AdminLTE
- **æ•°æ®åº“**: MySQL
- **JSæ¨¡å—ç®¡ç†**: RequireJS
- **æ ·å¼é¢„å¤„ç†**: Less
- **åŒ…ç®¡ç†**: Composer + Bower

## 2. ç›®å½•ç»“æ„è§„èŒƒ

```
project/
â”œâ”€â”€ application/           # åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ admin/            # åå°ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ controller/   # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ model/        # æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ view/         # è§†å›¾æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ lang/         # è¯­è¨€åŒ…
â”‚   â”‚   â””â”€â”€ config/       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ api/              # APIæ¥å£æ¨¡å—
â”‚   â”œâ”€â”€ index/            # å‰å°æ¨¡å—
â”‚   â””â”€â”€ common/           # å…¬å…±æ¨¡å—
â”œâ”€â”€ public/               # Webæ ¹ç›®å½•
â”‚   â”œâ”€â”€ assets/           # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ js/           # JavaScriptæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ css/          # CSSæ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ img/          # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ libs/         # ç¬¬ä¸‰æ–¹åº“
â”‚   â””â”€â”€ uploads/          # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ addons/               # æ’ä»¶ç›®å½•
â”œâ”€â”€ extend/               # æ‰©å±•ç±»åº“
â”œâ”€â”€ runtime/              # è¿è¡Œæ—¶ç›®å½•
â”œâ”€â”€ thinkphp/             # ThinkPHPæ¡†æ¶
â”œâ”€â”€ vendor/               # Composerä¾èµ–
â””â”€â”€ think                 # å‘½ä»¤è¡Œå·¥å…·
```

## 3. å¼€å‘è§„èŒƒ

### 3.1 å‘½åè§„èŒƒ
```php
// âœ… æ§åˆ¶å™¨ï¼šä½¿ç”¨å¤§é©¼å³°å‘½å
class UserController extends Backend
{
    // âœ… æ¨¡å‹ï¼šä½¿ç”¨å¤§é©¼å³°å‘½å
    protected $model = null;
    
    // âœ… æ–¹æ³•ï¼šä½¿ç”¨å°é©¼å³°å‘½å
    public function getUserInfo($userId)
    {
        // âœ… å˜é‡ï¼šä½¿ç”¨å°é©¼å³°å‘½å
        $userName = $this->request->param('username');
        return $userName;
    }
}

// âœ… æ•°æ®è¡¨ï¼šä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿ï¼Œå¿…é¡»ä»¥fa_ä¸ºå‰ç¼€
// è¡¨åï¼šfa_user, fa_user_group, fa_admin_log

// âœ… å­—æ®µï¼šä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿
// å­—æ®µï¼šuser_name, email_address, created_at
```

### 3.2 æ•°æ®è¡¨è®¾è®¡è§„èŒƒ
```sql
-- âœ… æ ‡å‡†æ•°æ®è¡¨ç»“æ„
CREATE TABLE `fa_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `username` varchar(32) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å',
  `nickname` varchar(50) NOT NULL DEFAULT '' COMMENT 'æ˜µç§°',
  `password` varchar(32) NOT NULL DEFAULT '' COMMENT 'å¯†ç ',
  `salt` varchar(30) NOT NULL DEFAULT '' COMMENT 'å¯†ç ç›',
  `email` varchar(100) NOT NULL DEFAULT '' COMMENT 'ç”µå­é‚®ç®±',
  `mobile` varchar(11) NOT NULL DEFAULT '' COMMENT 'æ‰‹æœºå·',
  `avatar` varchar(255) NOT NULL DEFAULT '' COMMENT 'å¤´åƒ',
  `status` varchar(30) NOT NULL DEFAULT 'normal' COMMENT 'çŠ¶æ€',
  `weigh` int(10) NOT NULL DEFAULT '0' COMMENT 'æƒé‡',
  `createtime` int(10) unsigned DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `updatetime` int(10) unsigned DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `deletetime` int(10) unsigned DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `username` (`username`),
  KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='ç”¨æˆ·è¡¨';
```

### 3.3 å¿…é¡»å­—æ®µè§„èŒƒ
- **id**: ä¸»é”®å­—æ®µï¼Œè‡ªå¢
- **createtime**: åˆ›å»ºæ—¶é—´ï¼Œintç±»å‹æ—¶é—´æˆ³
- **updatetime**: æ›´æ–°æ—¶é—´ï¼Œintç±»å‹æ—¶é—´æˆ³
- **deletetime**: åˆ é™¤æ—¶é—´ï¼Œintç±»å‹æ—¶é—´æˆ³ï¼ˆè½¯åˆ é™¤ï¼‰
- **status**: çŠ¶æ€å­—æ®µï¼Œé€šå¸¸ä¸ºnormal/hidden
- **weigh**: æ’åºæƒé‡å­—æ®µ

## 4. ä¸€é”®ç”ŸæˆCRUD â­ï¸

### 4.1 åŸºæœ¬å‘½ä»¤
```bash
# âœ… ç”Ÿæˆå•è¡¨CRUDï¼ˆæœ€å¸¸ç”¨ï¼‰
php think crud -t fa_user

# âœ… ç”Ÿæˆå¸¦æ§åˆ¶å™¨åˆ†ç»„çš„CRUD
php think crud -t fa_user -c user/profile

# âœ… ç”Ÿæˆå…³è”è¡¨CRUD
php think crud -t fa_user -r fa_user_group

# âœ… ç”Ÿæˆå¤šè¡¨å…³è”CRUD
php think crud -t fa_order -r fa_user,fa_product

# âœ… å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶
php think crud -t fa_user --force

# âœ… åŒæ—¶ç”Ÿæˆèœå•
php think crud -t fa_user --menu=1
```

### 4.2 å‘½ä»¤å‚æ•°è¯¦è§£
- `-t, --table`: æŒ‡å®šæ•°æ®è¡¨åï¼ˆå¿…é¡»ï¼‰
- `-c, --controller`: æŒ‡å®šæ§åˆ¶å™¨åç§°å’Œè·¯å¾„
- `-m, --model`: æŒ‡å®šæ¨¡å‹åç§°
- `-r, --relation`: æŒ‡å®šå…³è”è¡¨ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”
- `-f, --force`: å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶
- `--menu`: æ˜¯å¦åŒæ—¶ç”Ÿæˆèœå•ï¼ˆ1=æ˜¯ï¼Œ0=å¦ï¼‰
- `--lang`: æŒ‡å®šè¯­è¨€åŒ…ç›®å½•

### 4.3 ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
æ‰§è¡ŒCRUDå‘½ä»¤åè‡ªåŠ¨ç”Ÿæˆï¼š
```
application/admin/controller/User.php     # æ§åˆ¶å™¨æ–‡ä»¶
application/admin/model/User.php          # æ¨¡å‹æ–‡ä»¶
application/admin/view/user/index.html    # åˆ—è¡¨é¡µè§†å›¾
application/admin/view/user/add.html      # æ·»åŠ é¡µè§†å›¾
application/admin/view/user/edit.html     # ç¼–è¾‘é¡µè§†å›¾
application/admin/lang/zh-cn/user.php     # ä¸­æ–‡è¯­è¨€åŒ…
public/assets/js/backend/user.js          # å‰ç«¯JSæ–‡ä»¶
```

### 4.4 CRUDé«˜çº§ç”¨æ³•
```bash
# âœ… ç”ŸæˆAPIæ§åˆ¶å™¨
php think crud -t fa_user --mode=api

# âœ… æŒ‡å®šå­—æ®µç±»å‹ï¼ˆå½“è‡ªåŠ¨è¯†åˆ«ä¸å‡†ç¡®æ—¶ï¼‰
php think crud -t fa_user --fields="status:enum('normal','hidden')"

# âœ… æ’é™¤æŸäº›å­—æ®µ
php think crud -t fa_user --exclude="password,salt"

# âœ… åªç”Ÿæˆæ¨¡å‹æ–‡ä»¶
php think crud -t fa_user --only=model
```

## 5. æƒé™ç®¡ç†ç³»ç»Ÿ

### 5.1 æƒé™èŠ‚ç‚¹æ ¼å¼
```php
// âœ… æƒé™èŠ‚ç‚¹å‘½åè§„åˆ™
admin/user/index     # ç”¨æˆ·åˆ—è¡¨é¡µ
admin/user/add       # ç”¨æˆ·æ·»åŠ é¡µ
admin/user/edit      # ç”¨æˆ·ç¼–è¾‘é¡µ
admin/user/del       # ç”¨æˆ·åˆ é™¤æ“ä½œ
admin/user/multi     # ç”¨æˆ·æ‰¹é‡æ“ä½œ
```

### 5.2 ç”Ÿæˆèœå•å‘½ä»¤
```bash
# âœ… ä¸ºæ§åˆ¶å™¨ç”Ÿæˆèœå•
php think menu -c user

# âœ… ä¸ºæŒ‡å®šè·¯å¾„çš„æ§åˆ¶å™¨ç”Ÿæˆèœå•
php think menu -c user/profile

# âœ… å¼ºåˆ¶é‡æ–°ç”Ÿæˆèœå•
php think menu -c user --force

# âœ… ç”Ÿæˆèœå•å¹¶è®¾ç½®æƒé‡
php think menu -c user --weigh=100
```

### 5.3 æƒé™éªŒè¯ä»£ç 
```php
// âœ… åœ¨æ§åˆ¶å™¨ä¸­éªŒè¯æƒé™
public function edit($ids = null)
{
    // æ¡†æ¶ä¼šè‡ªåŠ¨éªŒè¯ admin/user/edit æƒé™
    
    // æ‰‹åŠ¨éªŒè¯æƒé™
    if (!$this->auth->check('admin/user/edit')) {
        $this->error('æ²¡æœ‰æƒé™');
    }
}

// âœ… åœ¨æ¨¡æ¿ä¸­éªŒè¯æƒé™
{if condition="$auth->check('admin/user/edit')"}
    <button class="btn btn-primary btn-edit">ç¼–è¾‘</button>
{/if}

{if condition="$auth->check('admin/user/del')"}
    <button class="btn btn-danger btn-del">åˆ é™¤</button>
{/if}
```

## 6. æ¨¡å‹å¼€å‘è§„èŒƒ

### 6.1 æ ‡å‡†æ¨¡å‹ç»“æ„
```php
<?php
namespace app\admin\model;

use think\Model;
use traits\model\SoftDelete;

/**
 * ç”¨æˆ·æ¨¡å‹
 */
class User extends Model
{
    use SoftDelete;
    
    // âœ… è¡¨åï¼ˆä¸å«å‰ç¼€ï¼‰
    protected $name = 'user';
    
    // âœ… è‡ªåŠ¨æ—¶é—´æˆ³
    protected $autoWriteTimestamp = 'int';
    
    // âœ… å®šä¹‰æ—¶é—´æˆ³å­—æ®µå
    protected $createTime = 'createtime';
    protected $updateTime = 'updatetime';
    protected $deleteTime = 'deletetime';
    
    // âœ… è¿½åŠ å±æ€§åˆ°JSON
    protected $append = [
        'status_text',
        'avatar_url'
    ];
    
    // âœ… å­—æ®µç±»å‹è½¬æ¢
    protected $type = [
        'createtime' => 'timestamp:Y-m-d H:i:s',
        'updatetime' => 'timestamp:Y-m-d H:i:s'
    ];

    /**
     * âœ… çŠ¶æ€æ–‡æœ¬è·å–å™¨
     */
    public function getStatusTextAttr($value, $data)
    {
        $value = $value ? $value : $data['status'];
        $list = ['normal' => 'æ­£å¸¸', 'hidden' => 'éšè—'];
        return isset($list[$value]) ? $list[$value] : '';
    }

    /**
     * âœ… å¤´åƒå®Œæ•´URLè·å–å™¨
     */
    public function getAvatarUrlAttr($value, $data)
    {
        $avatar = $data['avatar'] ?? '';
        return $avatar ? cdnurl($avatar, true) : '';
    }

    /**
     * âœ… å…³è”ç”¨æˆ·ç»„
     */
    public function group()
    {
        return $this->belongsTo('UserGroup', 'group_id');
    }

    /**
     * âœ… å…³è”ç”¨æˆ·è®¢å•
     */
    public function orders()
    {
        return $this->hasMany('Order', 'user_id');
    }
}
```

### 6.2 æ¨¡å‹å…³è”å…³ç³»
```php
// âœ… ä¸€å¯¹ä¸€å…³è”
public function profile()
{
    return $this->hasOne('UserProfile', 'user_id');
}

// âœ… ä¸€å¯¹å¤šå…³è”
public function orders()
{
    return $this->hasMany('Order', 'user_id');
}

// âœ… å¤šå¯¹å¤šå…³è”
public function roles()
{
    return $this->belongsToMany('Role', 'user_role', 'user_id', 'role_id');
}

// âœ… åå‘å…³è”
public function user()
{
    return $this->belongsTo('User', 'user_id');
}
```

## 7. æ§åˆ¶å™¨å¼€å‘è§„èŒƒ

### 7.1 æ ‡å‡†æ§åˆ¶å™¨ç»“æ„
```php
<?php
namespace app\admin\controller;

use app\common\controller\Backend;

/**
 * ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨
 */
class User extends Backend
{
    /**
     * æ¨¡å‹å¯¹è±¡
     */
    protected $model = null;
    
    /**
     * å¿«é€Ÿæœç´¢å­—æ®µ
     */
    protected $searchFields = 'id,username,nickname,email';
    
    /**
     * æ— éœ€ç™»å½•çš„æ–¹æ³•
     */
    protected $noNeedLogin = [];
    
    /**
     * æ— éœ€æƒé™éªŒè¯çš„æ–¹æ³•
     */
    protected $noNeedRight = [];
    
    /**
     * æƒé™æ§åˆ¶ç›¸å…³
     */
    protected $childrenAdminIds = [];
    protected $childrenGroupIds = [];
    
    public function _initialize()
    {
        parent::_initialize();
        $this->model = new \app\admin\model\User;
        
        // è·å–å­çº§ç®¡ç†å‘˜ID
        $this->childrenAdminIds = $this->auth->getChildrenAdminIds(true);
    }

    /**
     * âœ… æŸ¥çœ‹åˆ—è¡¨
     */
    public function index()
    {
        // è®¾ç½®è¿‡æ»¤æ–¹æ³•
        $this->request->filter(['strip_tags', 'trim']);
        
        if ($this->request->isAjax()) {
            // æ„å»ºæœç´¢æ¡ä»¶
            list($where, $sort, $order, $offset, $limit) = $this->buildparams();
            
            $list = $this->model
                ->with(['group'])  // é¢„åŠ è½½å…³è”
                ->where($where)
                ->order($sort, $order)
                ->paginate($limit);
                
            foreach ($list as $row) {
                $row->getRelation('group');  // è§¦å‘å…³è”æŸ¥è¯¢
            }
            
            $result = ['total' => $list->total(), 'rows' => $list->items()];
            return json($result);
        }
        
        return $this->view->fetch();
    }

    /**
     * âœ… æ·»åŠ è®°å½•
     */
    public function add()
    {
        if ($this->request->isPost()) {
            $params = $this->request->post('row/a');
            
            if (empty($params)) {
                $this->error(__('Parameter %s can not be empty', ''));
            }
            
            $params = $this->preExcludeFields($params);
            
            if ($this->model->allowField(true)->save($params)) {
                $this->success();
            } else {
                $this->error(__('No rows were inserted'));
            }
        }
        
        return $this->view->fetch();
    }

    /**
     * âœ… ç¼–è¾‘è®°å½•
     */
    public function edit($ids = null)
    {
        $row = $this->model->get($ids);
        if (!$row) {
            $this->error(__('No Results were found'));
        }
        
        if ($this->request->isPost()) {
            $params = $this->request->post('row/a');
            
            if (empty($params)) {
                $this->error(__('Parameter %s can not be empty', ''));
            }
            
            $params = $this->preExcludeFields($params);
            
            $result = $row->allowField(true)->save($params);
            if ($result !== false) {
                $this->success();
            } else {
                $this->error(__('No rows were updated'));
            }
        }
        
        $this->view->assign('row', $row);
        return $this->view->fetch();
    }
}
```

### 7.2 æ§åˆ¶å™¨å¸¸ç”¨æ–¹æ³•
```php
// âœ… æ‰¹é‡æ“ä½œ
public function multi($ids = '')
{
    $ids = $ids ? $ids : $this->request->param('ids');
    $action = $this->request->param('action');
    
    if (empty($ids) || empty($action)) {
        $this->error(__('Parameter %s can not be empty', ''));
    }
    
    $ids = explode(',', $ids);
    
    switch ($action) {
        case 'normal':
        case 'hidden':
            $this->model->where('id', 'in', $ids)->update(['status' => $action]);
            break;
        case 'delete':
            $this->model->where('id', 'in', $ids)->delete();
            break;
        default:
            $this->error(__('Unknown operation'));
    }
    
    $this->success();
}

// âœ… åˆ‡æ¢çŠ¶æ€
public function toggle($ids = null)
{
    $row = $this->model->get($ids);
    if (!$row) {
        $this->error(__('No Results were found'));
    }
    
    $row->status = $row->status == 'normal' ? 'hidden' : 'normal';
    $row->save();
    
    $this->success();
}
```

## 8. è§†å›¾å¼€å‘è§„èŒƒ

### 8.1 åˆ—è¡¨é¡µæ¨¡æ¿ç»“æ„
```html
<!-- âœ… æ ‡å‡†åˆ—è¡¨é¡µæ¨¡æ¿ -->
<div class="panel panel-default panel-intro">
    <!-- é¢æ¿å¤´éƒ¨ -->
    <div class="panel-heading">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#t1" data-toggle="tab">{:__('Tab 1')}</a></li>
        </ul>
    </div>
    
    <!-- é¢æ¿ä¸»ä½“ -->
    <div class="panel-body">
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in" id="t1">
                <div class="widget-body no-padding">
                    <!-- å·¥å…·æ  -->
                    <div id="toolbar" class="toolbar">
                        <a href="javascript:;" class="btn btn-primary btn-refresh" title="{:__('Refresh')}">
                            <i class="fa fa-refresh"></i>
                        </a>
                        <a href="javascript:;" class="btn btn-success btn-add" title="{:__('Add')}">
                            <i class="fa fa-plus"></i> {:__('Add')}
                        </a>
                        <a href="javascript:;" class="btn btn-success btn-edit btn-disabled disabled" title="{:__('Edit')}">
                            <i class="fa fa-pencil"></i> {:__('Edit')}
                        </a>
                        <a href="javascript:;" class="btn btn-danger btn-del btn-disabled disabled" title="{:__('Delete')}">
                            <i class="fa fa-trash"></i> {:__('Delete')}
                        </a>
                    </div>
                    
                    <!-- æ•°æ®è¡¨æ ¼ -->
                    <table id="table" class="table table-striped table-bordered table-hover table-nowrap" width="100%">
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
```

### 8.2 è¡¨å•é¡µæ¨¡æ¿ç»“æ„
```html
<!-- âœ… æ ‡å‡†è¡¨å•é¡µæ¨¡æ¿ -->
<form id="add-form" class="form-horizontal" role="form" data-toggle="validator" method="POST" action="">
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Username')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-username" data-rule="required" class="form-control" name="row[username]" type="text" placeholder="ï¿½ï¿½ï¿½è¾“å…¥ç”¨æˆ·å">
        </div>
    </div>
    
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Email')}:</label>
        <div class="col-xs-12 col-sm-8">
            <input id="c-email" data-rule="required;email" class="form-control" name="row[email]" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±">
        </div>
    </div>
    
    <div class="form-group">
        <label class="control-label col-xs-12 col-sm-2">{:__('Status')}:</label>
        <div class="col-xs-12 col-sm-8">
            <select id="c-status" data-rule="required" class="form-control selectpicker" name="row[status]">
                <option value="normal">{:__('Normal')}</option>
                <option value="hidden">{:__('Hidden')}</option>
            </select>
        </div>
    </div>
    
    <!-- æäº¤æŒ‰é’® -->
    <div class="form-group layer-footer">
        <label class="control-label col-xs-12 col-sm-2"></label>
        <div class="col-xs-12 col-sm-8">
            <button type="submit" class="btn btn-success btn-embossed disabled">{:__('OK')}</button>
            <button type="reset" class="btn btn-default btn-embossed">{:__('Reset')}</button>
        </div>
    </div>
</form>
```

## 9. JavaScriptå¼€å‘è§„èŒƒ

### 9.1 æ ‡å‡†JSæ–‡ä»¶ç»“æ„
```javascript
// âœ… FastAdminæ ‡å‡†JSæ¨¡å—ç»“æ„
define(['jquery', 'bootstrap', 'backend', 'table', 'form'], function ($, undefined, Backend, Table, Form) {
    var Controller = {
        index: function () {
            // åˆå§‹åŒ–è¡¨æ ¼å‚æ•°é…ç½®
            Table.api.init({
                extend: {
                    index_url: 'user/index' + location.search,
                    add_url: 'user/add',
                    edit_url: 'user/edit',
                    del_url: 'user/del',
                    multi_url: 'user/multi',
                    import_url: 'user/import',
                    table: 'user',
                }
            });

            var table = $("#table");

            // åˆå§‹åŒ–è¡¨æ ¼
            table.bootstrapTable({
                url: $.fn.bootstrapTable.defaults.extend.index_url,
                pk: 'id',
                sortName: 'id',
                fixedColumns: true,
                fixedRightNumber: 1,
                columns: [
                    [
                        {checkbox: true},
                        {field: 'id', title: __('Id')},
                        {field: 'username', title: __('Username'), operate: 'LIKE'},
                        {field: 'nickname', title: __('Nickname'), operate: 'LIKE'},
                        {field: 'email', title: __('Email'), operate: 'LIKE'},
                        {field: 'group.name', title: __('Group'), operate: false},
                        {field: 'status', title: __('Status'), searchList: {"normal":__('Normal'),"hidden":__('Hidden')}, formatter: Table.api.formatter.status},
                        {field: 'createtime', title: __('Createtime'), operate:'RANGE', addclass:'datetimerange', autocomplete:false, formatter: Table.api.formatter.datetime},
                        {field: 'operate', title: __('Operate'), table: table, events: Table.api.events.operate, formatter: Table.api.formatter.operate}
                    ]
                ]
            });

            // ä¸ºè¡¨æ ¼ç»‘å®šäº‹ä»¶
            Table.api.bindevent(table);
        },
        add: function () {
            Controller.api.bindevent();
        },
        edit: function () {
            Controller.api.bindevent();
        },
        api: {
            bindevent: function () {
                Form.api.bindevent($("form[role=form]"));
            }
        }
    };
    return Controller;
});
```

### 9.2 è¡¨æ ¼åˆ—é…ç½®è¯¦è§£
```javascript
// âœ… å¸¸ç”¨çš„åˆ—é…ç½®é€‰é¡¹
{
    field: 'username',           // å­—æ®µå
    title: __('Username'),       // åˆ—æ ‡é¢˜
    operate: 'LIKE',            // æœç´¢æ–¹å¼ï¼šLIKEã€=ã€!=ã€>ã€<ã€RANGEç­‰
    searchList: {},             // æœç´¢ä¸‹æ‹‰é€‰é¡¹
    formatter: function(value, row, index) {
        // è‡ªå®šä¹‰æ ¼å¼åŒ–å‡½æ•°
        return '<span class="text-primary">' + value + '</span>';
    },
    visible: true,              // æ˜¯å¦å¯è§
    sortable: true,             // æ˜¯å¦å¯æ’åº
    searchable: true,           // æ˜¯å¦å¯æœç´¢
    width: 120,                 // åˆ—å®½åº¦
    align: 'center',            // å¯¹é½æ–¹å¼
    valign: 'middle'            // å‚ç›´å¯¹é½
}
```

## 10. æ’ä»¶å¼€å‘è§„èŒƒ

### 10.1 æ’ä»¶ç›®å½•ç»“æ„
```
addons/example/
â”œâ”€â”€ Example.php              # æ’ä»¶ä¸»æ–‡ä»¶
â”œâ”€â”€ config.php              # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ info.ini                # æ’ä»¶ä¿¡æ¯æ–‡ä»¶
â”œâ”€â”€ install.sql             # å®‰è£…SQLæ–‡ä»¶
â”œâ”€â”€ uninstall.sql           # å¸è½½SQLæ–‡ä»¶
â”œâ”€â”€ upgrade.sql             # å‡çº§SQLæ–‡ä»¶
â”œâ”€â”€ controller/             # æ§åˆ¶å™¨ç›®å½•
â”‚   â”œâ”€â”€ Index.php
â”‚   â””â”€â”€ Api.php
â”œâ”€â”€ model/                  # æ¨¡å‹ç›®å½•
â”‚   â””â”€â”€ Example.php
â”œâ”€â”€ view/                   # è§†å›¾ç›®å½•
â”‚   â””â”€â”€ index/
â”‚       â””â”€â”€ index.html
â”œâ”€â”€ public/                 # é™æ€èµ„æºç›®å½•
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ css/
â”‚   â””â”€â”€ uploads/
â””â”€â”€ lang/                   # è¯­è¨€åŒ…ç›®å½•
    â””â”€â”€ zh-cn.php
```

### 10.2 æ’ä»¶ä¸»æ–‡ä»¶
```php
<?php
namespace addons\example;

use think\Addons;

/**
 * ç¤ºä¾‹æ’ä»¶
 */
class Example extends Addons
{
    /**
     * æ’ä»¶ä¿¡æ¯
     */
    public $info = [
        'name' => 'example',
        'title' => 'ç¤ºä¾‹æ’ä»¶',
        'description' => 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ’ä»¶ï¼Œæ¼”ç¤ºæ’ä»¶çš„åŸºæœ¬åŠŸèƒ½',
        'status' => 1,
        'author' => 'Lyfe',
        'version' => '1.0.0'
    ];

    /**
     * æ’ä»¶å®‰è£…æ–¹æ³•
     */
    public function install()
    {
        $menu = [
            [
                'name' => 'example',
                'title' => 'ç¤ºä¾‹æ’ä»¶',
                'icon' => 'fa fa-cog',
                'weigh' => 0,
                'sublist' => [
                    [
                        'name' => 'example/index',
                        'title' => 'æ’ä»¶é¦–é¡µ',
                        'icon' => 'fa fa-circle-o',
                        'weigh' => 0
                    ]
                ]
            ]
        ];
        
        // åˆ›å»ºèœå•
        \app\common\model\Menu::create($menu);
        
        return true;
    }

    /**
     * æ’ä»¶å¸è½½æ–¹æ³•
     */
    public function uninstall()
    {
        // åˆ é™¤èœå•
        \app\common\model\Menu::where('name', 'example')->delete();
        
        return true;
    }

    /**
     * æ’ä»¶å¯ç”¨æ–¹æ³•
     */
    public function enable()
    {
        \app\common\model\Menu::where('name', 'example')->update(['status' => 'normal']);
        return true;
    }

    /**
     * æ’ä»¶ç¦ç”¨æ–¹æ³•
     */
    public function disable()
    {
        \app\common\model\Menu::where('name', 'example')->update(['status' => 'hidden']);
        return true;
    }
}
```

## 11. å¸¸ç”¨å‘½ä»¤æ±‡æ€» â­ï¸

### 11.1 CRUDç›¸å…³å‘½ä»¤
```bash
# âœ… åŸºç¡€CRUDç”Ÿæˆ
php think crud -t fa_user                              # ç”Ÿæˆç”¨æˆ·CRUD
php think crud -t fa_category -c content/category      # ç”Ÿæˆåˆ†ç±»CRUDåˆ°contentç›®å½•
php think crud -t fa_article -r fa_category            # ç”Ÿæˆæ–‡ç« CRUDï¼Œå…³è”åˆ†ç±»è¡¨

# âœ… é«˜çº§CRUDç”Ÿæˆ
php think crud -t fa_order -r fa_user,fa_product --force    # å¼ºåˆ¶ç”Ÿæˆè®¢å•CRUD
php think crud -t fa_news --menu=1                     # ç”Ÿæˆæ–°é—»CRUDå¹¶åˆ›å»ºèœå•
php think crud -t fa_config --mode=api                 # ç”ŸæˆAPIæ¨¡å¼çš„CRUD

# âœ… è‡ªå®šä¹‰å­—æ®µç±»å‹
php think crud -t fa_user --fields="status:enum('normal','hidden'),avatar:image"
```

### 11.2 èœå•ç›¸å…³å‘½ä»¤
```bash
# âœ… èœå•ç”Ÿæˆå‘½ä»¤
php think menu -c user                    # ä¸ºuseræ§åˆ¶å™¨ç”Ÿæˆèœå•
php think menu -c content/article --force # å¼ºåˆ¶é‡æ–°ç”Ÿæˆèœå•
php think menu -c user --delete           # åˆ é™¤useræ§åˆ¶å™¨çš„èœå•
```

### 11.3 æ’ä»¶ç›¸å…³å‘½ä»¤
```bash
# âœ… æ’ä»¶ç®¡ç†å‘½ä»¤
php think addon -a create -n example         # åˆ›å»ºexampleæ’ä»¶
php think addon -a install -n example        # å®‰è£…exampleæ’ä»¶
php think addon -a uninstall -n example      # å¸è½½exampleæ’ä»¶
php think addon -a enable -n example         # å¯ç”¨exampleæ’ä»¶
php think addon -a disable -n example        # ç¦ç”¨exampleæ’ä»¶
php think addon -a upgrade -n example        # å‡çº§exampleæ’ä»¶
php think addon -a package -n example        # æ‰“åŒ…exampleæ’ä»¶
```

### 11.4 ç³»ç»Ÿç»´æŠ¤å‘½ä»¤
```bash
# âœ… ç¼“å­˜ç®¡ç†
php think clear                    # æ¸…é™¤æ‰€æœ‰ç¼“å­˜
php think clear --cache           # æ¸…é™¤æ¨¡æ¿ç¼“å­˜
php think clear --log             # æ¸…é™¤æ—¥å¿—æ–‡ä»¶

# âœ… ä¼˜åŒ–å‘½ä»¤
php think optimize:config         # ç”Ÿæˆé…ç½®ç¼“å­˜
php think optimize:route          # ç”Ÿæˆè·¯ç”±ç¼“å­˜
php think optimize:schema         # ç”Ÿæˆæ•°æ®è¡¨å­—æ®µç¼“å­˜

# âœ… æ•°æ®åº“ç®¡ç†
php think migrate:run             # æ‰§è¡Œæ•°æ®åº“è¿ç§»
php think seed:run                # æ‰§è¡Œæ•°æ®å¡«å……
```

### 11.5 APIæ–‡æ¡£ç”Ÿæˆ
```bash
# âœ… APIæ–‡æ¡£ç”Ÿæˆ
php think api -c user             # ä¸ºuseræ§åˆ¶å™¨ç”ŸæˆAPIæ–‡æ¡£
php think api -c user --force     # å¼ºåˆ¶é‡æ–°ç”ŸæˆAPIæ–‡æ¡£
php think api --all               # ä¸ºæ‰€æœ‰æ§åˆ¶å™¨ç”ŸæˆAPIæ–‡æ¡£
```

## 12. æœ€ä½³å®è·µæŒ‡å—

### 12.1 å¼€å‘æµç¨‹è§„èŒƒ
```bash
# âœ… æ ‡å‡†å¼€å‘æµç¨‹
1. è®¾è®¡æ•°æ®è¡¨ç»“æ„ï¼ˆéµå¾ªå‘½åè§„èŒƒï¼Œæ·»åŠ å¿…è¦æ³¨é‡Šï¼‰
2. æ‰§è¡ŒCRUDç”Ÿæˆå‘½ä»¤
   php think crud -t fa_user --menu=1
3. ä¿®æ”¹æ§åˆ¶å™¨ä¸šåŠ¡é€»è¾‘
4. è°ƒæ•´æ¨¡å‹å…³è”å…³ç³»
5. ä¼˜åŒ–è§†å›¾æ¨¡æ¿å’ŒJSæ–‡ä»¶
6. æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§
7. ç”ŸæˆAPIæ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰
   php think api -c user
```

### 12.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®
```php
// âœ… æ¨¡å‹æŸ¥è¯¢ä¼˜åŒ–
// ä½¿ç”¨é¢„åŠ è½½é¿å…N+1æŸ¥è¯¢
$users = User::with(['group', 'profile'])->select();

// åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
$users = User::field('id,username,email')->select();

// ä½¿ç”¨ç¼“å­˜
$user = Cache::remember('user_' . $id, function() use ($id) {
    return User::get($id);
}, 3600);

// âœ… æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
// ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•
ALTER TABLE `fa_user` ADD INDEX `idx_status` (`status`);
ALTER TABLE `fa_user` ADD INDEX `idx_createtime` (`createtime`);
```

### 12.3 å®‰å…¨æœ€ä½³å®è·µ
```php
// âœ… è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
public function add()
{
    if ($this->request->isPost()) {
        $params = $this->request->post('row/a');
        
        // è¿‡æ»¤å±é™©å­—ç¬¦
        $params = $this->preExcludeFields($params);
        
        // æ•°æ®éªŒè¯
        $validate = \think\Loader::validate('User');
        if (!$validate->check($params)) {
            $this->error($validate->getError());
        }
        
        // ä½¿ç”¨æ¨¡å‹è‡ªåŠ¨è¿‡æ»¤
        if ($this->model->allowField(true)->save($params)) {
            $this->success();
        }
    }
}

// âœ… XSSé˜²æŠ¤
{$content|raw}              # è¾“å‡ºåŸå§‹å†…å®¹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
{$content|htmlentities}     # HTMLå®ä½“è½¬ä¹‰
{$content}                  # é»˜è®¤ä¼šè¿›è¡ŒHTMLè½¬ä¹‰
```

## 13. å¸¸è§é—®é¢˜è§£å†³

### 13.1 CRUDç”Ÿæˆé—®é¢˜
```bash
# âŒ å¸¸è§é”™è¯¯ï¼šè¡¨ä¸å­˜åœ¨
Error: Table 'fa_user' doesn't exist

# âœ… è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®ä¿æ•°æ®è¡¨å·²åˆ›å»ºå¹¶å­˜åœ¨
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
3. ç¡®è®¤è¡¨åå‰ç¼€æ­£ç¡®

# âŒ å¸¸è§é”™è¯¯ï¼šæƒé™ä¸è¶³
Error: Permission denied

# âœ… è§£å†³æ–¹æ¡ˆï¼š
chmod -R 755 application/
chmod -R 755 public/assets/
```

### 13.2 æƒé™ç³»ç»Ÿé—®é¢˜
```php
// âŒ å¸¸è§é”™è¯¯ï¼šæƒé™èŠ‚ç‚¹æ— æ•ˆ
Error: Rule 'admin/user/index' not found

// âœ… è§£å†³æ–¹æ¡ˆï¼š
1. é‡æ–°ç”Ÿæˆèœå•ï¼šphp think menu -c user --force
2. æ¸…é™¤ç¼“å­˜ï¼šphp think clear
3. æ£€æŸ¥ç®¡ç†å‘˜ç»„æƒé™é…ç½®
```

### 13.3 æ’ä»¶å¼€å‘é—®é¢˜
```php
// âŒ å¸¸è§é”™è¯¯ï¼šæ’ä»¶ç±»ä¸å­˜åœ¨
Error: Class 'addons\example\Example' not found

// âœ… è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥æ’ä»¶ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ’ä»¶ä¸»æ–‡ä»¶ç±»åä¸æ–‡ä»¶åä¸€è‡´
3. æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦æ­£ç¡®
```

## 14. è¿›é˜¶æŠ€å·§

### 14.1 è‡ªå®šä¹‰å­—æ®µç±»å‹
```bash
# âœ… åœ¨CRUDç”Ÿæˆæ—¶æŒ‡å®šå­—æ®µç±»å‹
php think crud -t fa_user --fields="avatar:image,content:editor,tags:selectpage"

# æ”¯æŒçš„å­—æ®µç±»å‹ï¼š
text        # æ–‡æœ¬æ¡†
textarea    # æ–‡æœ¬åŸŸ
select      # ä¸‹æ‹‰é€‰æ‹©
radio       # å•é€‰æ¡†
checkbox    # å¤é€‰æ¡†
image       # å›¾ç‰‡ä¸Šä¼ 
file        # æ–‡ä»¶ä¸Šä¼ 
editor      # å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
datetime    # æ—¥æœŸæ—¶é—´é€‰æ‹©
selectpage  # åˆ†é¡µé€‰æ‹©
citypicker  # åŸå¸‚é€‰æ‹©
```

### 14.2 æ‰¹é‡æ“ä½œæ‰©å±•
```php
// âœ… åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ è‡ªå®šä¹‰æ‰¹é‡æ“ä½œ
public function multi($ids = '')
{
    // ... åŸºç¡€ä»£ç  ...
    
    switch ($action) {
        case 'export':
            // å¯¼å‡ºé€‰ä¸­è®°å½•
            return $this->exportData($ids);
        case 'send_email':
            // ç»™é€‰ä¸­ç”¨æˆ·å‘é€é‚®ä»¶
            return $this->sendEmail($ids);
        case 'update_level':
            // æ‰¹é‡æ›´æ–°ç”¨æˆ·ç­‰çº§
            $level = $this->request->param('level');
            $this->model->where('id', 'in', $ids)->update(['level' => $level]);
            break;
    }
}
```

## 15. å‚è€ƒèµ„æº

### 15.1 å®˜æ–¹æ–‡æ¡£
- **FastAdminå®˜æ–¹æ–‡æ¡£**: https://doc.fastadmin.net
- **åœ¨çº¿æ¼”ç¤ºç³»ç»Ÿ**: https://demo.fastadmin.net
- **GitHubä»“åº“**: https://github.com/karsonzhang/fastadmin
- **é—®ç­”ç¤¾åŒº**: https://ask.fastadmin.net

### 15.2 ç›¸å…³æŠ€æœ¯æ–‡æ¡£
- **ThinkPHP5.1**: https://www.kancloud.cn/manual/thinkphp5_1
- **Bootstrap**: https://getbootstrap.com/docs/3.4/
- **AdminLTE**: https://adminlte.io/themes/AdminLTE/index2.html
- **RequireJS**: https://requirejs.org/

### 15.3 å­¦ä¹ è§†é¢‘
- FastAdminå®˜æ–¹è§†é¢‘æ•™ç¨‹
- ThinkPHPæ¡†æ¶æ•™ç¨‹
- Bootstrapå‰ç«¯æ¡†æ¶æ•™ç¨‹

---

> ğŸ’¡ **å¼€å‘æç¤º**: FastAdminçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶ä¸€é”®ç”ŸæˆåŠŸèƒ½ï¼Œèƒ½å¤Ÿæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚åˆç†ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œéµå¾ªæ¡†æ¶è§„èŒƒï¼Œèƒ½è®©ä½ çš„å¼€å‘äº‹åŠåŠŸå€ï¼